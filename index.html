<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kuku jempol malas ngedit rajin ngoding</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        .container {
            width: 100%;
            display: flex;
            flex-direction: column;
        }
        .contentAsli {
            display: flex;
            flex-direction: column;
            gap: 32px;
            width: 100%;
            margin: 1rem;
            .hero {
                select {
                    height: 24px;
                    width: max-content;
                }
                .bagianGear {
                    display: flex;
                    flex-direction: column;
                }
            }
        }
        
        .poster {
            width: 100%;
            aspect-ratio: 9/16;
            
            background-color: #0a0a0a;
            display: flex;
            align-items: center;

            padding: 34px;
            .displayImage {
                width: 100%;

                display: grid;
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(2, auto);

                gap: 0;

                .heroImage {
                    justify-self: start;
                    width: 100%;
                    height: max-content;
                    position: relative;
                    background-color: transparent;
                    
                    .hero {
                        width: 100%;
                        aspect-ratio: 1;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        img {
                            max-width: 100%;
                            max-height: 100%;
                            
                            /* 2. Pastikan dimensi yang tidak dibatasi dihitung otomatis */
                            width: auto;
                            height: auto;
                        }
                    }
                    .bagianGearImage {
                        position: absolute;
                        bottom: 0;
                        left: 0;
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        padding: 4px;
                        gap: 4px;
                        width: 100%;

                        .imageGear1, .imageGear2 {
                            width: 100%;
                            aspect-ratio: 1;
                        }
                    }
                }
                .heroImage:nth-child(even){
                    justify-self: end;
                }
                
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="contentAsli">
            <!-- buat ini di js -->
    
        </div>
        <div class="poster">
            <div class="displayImage">
    
                <!-- ini dibuat di js -->
        
            </div>
        </div>
    </div>

    <button id="convertButton">jadikanForto</button>
    <div id="output">
    </div>
    

<script>
    async function fetchApiGearHero() {
        let data = {};
        try {
            // Melakukan fetch ke path relatif
            const response = await fetch("api_asset_gearHero.json");

            if (!response.ok) {
                // Melemparkan error jika status HTTP bukan 200-299
                throw new Error(`Gagal memuat file: ${response.statusText}`);
            }

            // Mengubah respons menjadi objek JavaScript
            data = await response.json(); 
            
            Object.keys(data).forEach(folderName => {
                const fileList = data[folderName];

                console.log(`\nFolder saat ini: ${folderName}`);
            });
            
        } catch (error) {
            console.error("Kesalahan Fetch API:", error);
        } finally {
            const wadah = document.querySelector(".contentAsli");
            const displayImage = document.querySelector(".displayImage");

            
            const namaHero = Object.keys(data).map(ini => {
                return ini;
            }).join(",").split(",");
            console.log(namaHero);
            
            namaHero.forEach((ini, i) => {
                if(i >= 1){
                    const bagian = document.createElement("div");
                    bagian.className = "hero";
                    const bagianImageHero = document.createElement("div");
                    bagianImageHero.className = "heroImage";
                    
                    const selectElement = document.createElement("select");
                    selectElement.className = "heroyang"
                    
                    const bagianGear = document.createElement("div");
                    bagianGear.className = "bagianGear"
                    const bagianGearImage = document.createElement("div");
                    bagianGearImage.className = "bagianGearImage"


                    const selectGear = document.createElement("select");
                    selectGear.className = "gear"
                    const selectGear2 = document.createElement("select");
                    selectGear2.className = "gear2"
                    
                    
                    namaHero.forEach(ini2 => {
                        const optionElement = document.createElement("option");
                        optionElement.value = ini2;
                        optionElement.textContent = ini2;
                        selectElement.appendChild(optionElement);
                    });

                    data[namaHero[i]].forEach(ini2 => {
                        const namaGear = document.createElement('option');
                        namaGear.value = ini2;
                        namaGear.textContent = ini2;
                        selectGear.appendChild(namaGear);
                    })
                    data[namaHero[i]].forEach(ini2 => {
                        const namaGear = document.createElement('option');
                        namaGear.value = ini2;
                        namaGear.textContent = ini2;
                        selectGear2.appendChild(namaGear);
                    })

                    selectElement.value = ini;
                    bagian.appendChild(selectElement);
                    
                    bagianGear.appendChild(selectGear);
                    bagianGear.appendChild(selectGear2);

                    bagian.appendChild(bagianGear);


                    wadah.appendChild(bagian);

                    const imageHeroDiv = document.createElement('div');
                    imageHeroDiv.className = "hero";
                    const imageHero = document.createElement('img');
                    imageHero.src = `asset/image/hero/${namaHero[i]}.png`;
                    imageHero.alt = "foto";
                    imageHero.className = "pot";
                    imageHeroDiv.appendChild(imageHero);
                    
                    const imageGear = document.createElement('img');
                    imageGear.src = `asset/image/gear_hero/${namaHero[i]}/${data[namaHero[i]][parseInt(i) + 1]}`;
                    imageGear.alt = "foto";
                    imageGear.className = "imageGear1";
                    const imageGear2 = document.createElement('img');
                    imageGear2.src = `asset/image/gear_hero/${namaHero[i]}/${data[namaHero[i]][i]}`;
                    imageGear2.alt = "foto";
                    imageGear2.className = "imageGear2";

                    
                    bagianGearImage.appendChild(imageGear);
                    bagianGearImage.appendChild(imageGear2);
                    

                    bagianImageHero.appendChild(imageHeroDiv);
                    bagianImageHero.appendChild(bagianGearImage)

                    displayImage.appendChild(bagianImageHero);

                }
            })

            siapkanListenerTombol(data);
            divTarget = document.querySelectorAll('.heroImage');
        }
    }

    fetchApiGearHero();


</script>
<script>
    function siapkanListenerTombol(data){
        const pilihanHero = document.querySelectorAll(".heroyang");
        const pilihanGear = document.querySelectorAll(".gear");
        const pilihanGear2 = document.querySelectorAll(".gear2");

        const displayImageHero = document.querySelectorAll(".heroImage .hero img.pot");
        const displayImageGear1 = document.querySelectorAll(".imageGear1")
        const displayImageGear2 = document.querySelectorAll(".imageGear2")



        pilihanHero.forEach((ini, i) => {
            console.log(ini.value)
            ini.addEventListener("click", function(){
                displayImageHero[i].src = `asset/image/hero/${ini.value}.png`;


                pilihanGear[i].innerHTML = "";
                pilihanGear2[i].innerHTML = "";

                data[ini.value].forEach(apa => {
                    const optionElement = document.createElement("option");
                    const optionElement2 = document.createElement("option");
                    optionElement.value = apa;
                    optionElement2.value = apa;
                    optionElement.textContent = apa;
                    optionElement2.textContent = apa;
                    pilihanGear[i].appendChild(optionElement);
                    pilihanGear2[i].appendChild(optionElement2);
                })
            })
        });

        pilihanGear.forEach((ini, i) => {
            ini.addEventListener('click',  function(){
                displayImageGear1[i].src = `asset/image/gear_hero/${pilihanHero[i].value}/${ini.value}`;
            })
        })
        pilihanGear2.forEach((ini, i) => {
            ini.addEventListener('click',  function(){
                displayImageGear2[i].src = `asset/image/gear_hero/${pilihanHero[i].value}/${ini.value}`;
            })
        })

    }

</script>

<script>
    let divTarget = document.querySelectorAll('.heroImage');
    const convertButton = document.getElementById('convertButton');
    const outputDiv = document.getElementById('output');

    convertButton.addEventListener('click', () => {
        // Hapus hasil sebelumnya
        outputDiv.innerHTML = ''; 
        
        divTarget.forEach((ini) => {
            console.log("Memproses elemen...");
            
            try {
                // MODIFIKASI: Tambahkan objek opsi kedua
                html2canvas(ini, {
                    // Mencegah html2canvas mengisi latar belakang dengan warna putih default.
                    // Ini adalah kunci agar latar belakang transparan.
                    backgroundColor: null, 
                    
                    // Opsional: Untuk resolusi tinggi
                    // scale: 2 
                }).then(canvas => {
                    
                    // Sisanya tetap sama: toDataURL() secara default menghasilkan PNG, yang mendukung transparansi.
                    const imgDataUrl = canvas.toDataURL('image/png'); 
                    
                    const img = document.createElement('img');
                    img.src = imgDataUrl;
                    img.alt = "Hasil Konversi Transparan";
                    
                    outputDiv.appendChild(img);

                    buatTautanDownload(imgDataUrl);
                    
                    console.log("Konversi berhasil dengan latar belakang transparan.");
                });
            } catch(err){
                console.error("Kesalahan saat konversi:", err);
            }
        });
    });
    
    function buatTautanDownload(imgDataUrl) {
        const downloadLink = document.createElement('a');
        downloadLink.href = imgDataUrl;
        downloadLink.download = 'div_screenshot_transparent.png'; 
        downloadLink.textContent = 'Unduh Gambar PNG Transparan';
        downloadLink.style.display = 'block';
        downloadLink.style.marginTop = '10px';
        
        outputDiv.appendChild(downloadLink);
    }
</script>

</body>
</html>